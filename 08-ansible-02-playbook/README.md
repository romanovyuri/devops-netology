# Домашнее задание к занятию "08.02 Работа с Playbook"

## Решение

Написан playbook [Playbook](./site.yml) для настройки хостов с Elasticsearch и Kibana:  [Inventory](./inventory/prod.yml)


Окружение запускаем на 2-х докер контейнерах в ручном режиме:

Для Elasticsearch:
```commandline
# docker run -it --rm --name elastic -p 9200:9200 centos:7
```
Для Kibana

```commandline
# docker run -it --rm --name kibana -p 5601:5601 centos:7
```
Тэги:
- *java - для задач по установке Java на все хосты.*
- *elastic - для задач по установке Elasticsearch на хосты из группы Elastic.* 
- *kibana - для задач по установке Kibana на хосты из группы Kibana.* 

Playbook состоит из следующих задач для групп хостов:
1. Для всех хостов (тег - java):
    * Сбор фактов
    * Установка переменной java_home, используя значения из параметров [group vars for all](./group_vars/all/vars.yml)
    * Копируется файл .tar.gz из локального хранилища
    * Создается директория для установки, если она не существует. Используется переменная java_home, права на папку 0644
    * Распаковывается ранее скопированный архив в подготовленную директорию
    * Подготавливается скрипт для установки переменных окружения /etc/profile.d/jdk.sh из [шаблона](./templates/jdk.sh.j2)

2. Для хостов из группы elastic в (тег - elastic):
    * Сбор фактов, значений параметров [group vars for elasticsearch](./group_vars/elasticsearch/vars.yml)
    * Создается группа elastic, если она не существует
    * Создается пользователь elastic и группа elastic, если он не существует.
    * Копируется файл .tar.gz с удаленного URL (в моем случае докер контейнер с NGINX) во временную директорию
    * Создается директория для установки, если она не существует. Используется переменная elastic_home, права на папку 0755, владелец elastic
    * Распаковывается ранее скопированный архив в подготовленную директорию
    * Подготавливается скрипт для установки переменных окружения /etc/profile.d/elk.sh из [шаблона](./templates/elk.sh.j2)
    

3. Для хостов из группы kibana в (тег - kibana):
    * Сбор фактов, значений параметров [group vars for kibana](./group_vars/kibana/vars.yml)
    * Создается группа kibana, если она не существует
    * Создается пользователь kibana и группа kibana, если он не существует.
    * Копируется файл .tar.gz с удаленного URL (в моем случае докер контейнер с NGINX) во временную директорию
    * Создается директория для установки, если она не существует. Используется переменная kibana_home, права на папку 0755, владелец kibana
    * Распаковывается ранее скопированный архив в подготовленную директорию
    
