# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

    **Windows**

    `> ipconfig /all`

    ```
    Ethernet adapter Ethernet:
    
       Description . . . . . . . . . . . : Realtek PCIe FE Family Controller
       Physical Address. . . . . . . . . : D4-3D-7E-03-FE-80
       DHCP Enabled. . . . . . . . . . . : Уes
       Autoconfiguration Enabled . . . . : Yes
       Link-local IPv6 Address . . . . . : fe80::99c0:e9ae:6ca9:2a00%11(Preferred)
       IPv4 Address. . . . . . . . . . . : 192.168.10.113(Preferred)
       Subnet Mask . . . . . . . . . . . : 255.255.255.0
       Lease Obtained. . . . . . . . . . : 29 декабря 2021 г. 22:56:32
       Lease Expires . . . . . . . . . . : 31 декабря 2021 г. 22:56:32
       Default Gateway . . . . . . . . . : 192.168.10.1
       DHCP Server . . . . . . . . . . . : 192.168.10.1
       DHCPv6 IAID . . . . . . . . . . . : 248790398
       DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-1D-04-6D-96-D4-3D-7E-03-FE-80
       DNS Servers . . . . . . . . . . . : 192.168.10.1
       NetBIOS over Tcpip. . . . . . . . : Enabled
    ```

    **Linux**

    `$ ip -c -br link`

    ```
    
      lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP> 
      enp2s0           UP             94:de:80:12:86:11 <BROADCAST,MULTICAST,UP,LOWER_UP> 

    ```

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

    *Протокол LLDP. Установка пакета*

    `$ sudo apt install lldpd`

    ```
    $ sudo systemctl enable lldpd
    $ sudo systemctl start lldpd
    ```

    *Посмотреть соседей*

    `$ lldpctl`

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

    *Технология  802.1q*
    
    *Установка пакета для поддержки vlan*

    `$ sudo apt install vlan`

    *Нужно подгрузить модуль ядра с поддержкой vlan и добавить его в автозагрузку*

    ```
      $ sudo modprobe 8021q
    ```

    *Создаем интерфейс для vlan 200*

    `$ sudo vconfig add enp2s0 200`
    ```
        ifconfig -a
          enp2s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
                inet 192.168.10.112  netmask 255.255.255.0  broadcast 192.168.10.255
                inet6 fe80::e7e7:ca98:188f:74d2  prefixlen 64  scopeid 0x20<link>
                ether 94:de:80:12:86:11  txqueuelen 1000  (Ethernet)
                RX packets 4683513  bytes 5190401259 (5.1 GB)
                RX errors 0  dropped 605  overruns 0  frame 0
                TX packets 2811810  bytes 305131551 (305.1 MB)
                TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

          enp2s0.200: flags=4098<BROADCAST,MULTICAST>  mtu 1500
                ether 94:de:80:12:86:11  txqueuelen 1000  (Ethernet)
                RX packets 0  bytes 0 (0.0 B)
                RX errors 0  dropped 0  overruns 0  frame 0
                TX packets 0  bytes 0 (0.0 B)
                TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

          lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
                inet 127.0.0.1  netmask 255.0.0.0
                inet6 ::1  prefixlen 128  scopeid 0x10<host>
                loop  txqueuelen 1000  (Локальная петля (Loopback))
                RX packets 342214  bytes 29380957 (29.3 MB)
                RX errors 0  dropped 0  overruns 0  frame 0
                TX packets 342214  bytes 29380957 (29.3 MB)
                TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   ```

    *Назначаем  адрес 10.0.10.1/24 и поднимаем интерфейс*

    `$ sudo ifconfig enp2s0.200 10.0.10.1 netmask 255.255.255.0 up

        

   *Для того, чтобы интерфейс поднимался каждый раз после загрузки системы, его надо добавить в файл /etc/network/interfaces*

     `$ sudo nano /etc/network/interfaces`

    ```
        #Interface enps20.200 - tagged vlan 200
        auto enp2s0.200
        iface enp2s0.200 inet static
        address 10.0.10.1
        netmask 255.255.255.0
    ```

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

    *Агрегирование сетевых интерфейсов называется "бондингом". Управление агрегированием осуществляется с помощью утилиты *ifenslave* Несколько интерфейсов объединяются в группу для отказоустойчивости и увеличения пропускной способности путем балансировки.*

    **_mode = 0 (balancer-rr)_**

    *Политика round-robin. Пакеты отправляются последовательно, начиная с первого доступного интерфейса и заканчивая последним. Эта политика применяется для балансировки нагрузки и отказоустойчивости.* 

    **_mode = 1 (active-backup)_**

    *Политика активный-резервный. Только один сетевой интерфейс из объединённых будет активным. Другой интерфейс может стать активным, только в том случае, когда упадёт текущий активный интерфейс. При такой политике MAC адрес bond интерфейса виден снаружи только через один сетевой порт, во избежание появления проблем с коммутатором. Эта политика применяется для отказоустойчивости.*

    **_mode = 2 (balance-xor)_**

    *Политика XOR. Передача распределяется между сетевыми картами используя формулу: [( «MAC адрес источника» XOR «MAC адрес назначения») по модулю «число интерфейсов»]. Получается одна и та же сетевая карта передаёт пакеты одним и тем же получателям. Опционально распределение передачи может быть основано и на политике «xmit_hash».  Политика XOR применяется для балансировки нагрузки и отказоустойчивости. *

    **_mode = 3 (broadcast)_**

    *Широковещательная политика. Передает всё на все сетевые интерфейсы. Эта политика применяется для отказоустойчивости.*

    **_mode = 4 (802.3ad)_**

    *IEEE 802.3ad Dynamic Link aggregation (динамическое объединение каналов). Создает агрегации групп интерфейсов, имеющие одни и те же скорости и дуплексные настройки. Использует все включенные интерфейсы согласно спецификации 802.3ad. Поддержка ethtool для получения скорости и дуплекса каждого интерфейса. Требуется коммутатор с поддержкой IEEE 802.3ad и настройка режима.*

    **_mode =5 (balance-tlb)_**

    *Политика адаптивной балансировки нагрузки передачи. Исходящий трафик распределяется в зависимости от загруженности каждой сетевой карты (определяется скоростью загрузки). Не требует дополнительной настройки на коммутаторе. Входящий трафик приходит на текущую сетевую карту. Если она выходит из строя, то другая сетевая карта берёт себе MAC адрес вышедшей из строя карты. Требования:Поддержка Ethtool в драйвере, для получения информации о скорости загрузки на каждом сетевом интерфейсе.*

    **_mode = 6 (balance-alb)_**

    *Политика адаптивной балансировки нагрузки. Включает в себя политику balance-tlb плюс осуществляет балансировку входящего трафика. Не требует дополнительной настройки на коммутаторе. Балансировка входящего трафика достигается путём ARP переговоров. Драйвер bonding перехватывает ARP ответы, отправляемые с локальных сетевых карт наружу, и переписывает MAC адрес источника на один из уникальных MAC адресов сетевой карты, участвующей в объединении. Таким образом различные пиры используют различные MAC адреса сервера. Балансировка входящего трафика распределяется последовательно (round-robin) между интерфейсами. Требования: 1. Поддержка Ethtool в драйвере, для получения информации о скорости загрузки на каждом сетевом интерфейсе. 2. Поддержка в драйвере замены MAC адреса на включенном устройстве. 3. Возможно придётся корректировать значение параметра updelay равным или большим, чем значение задержки на коммутаторе (что бы ARP ответы небыли заблокированы на коммутаторе при переподключении линка, либо при добавлении новой сетевой карты в bonding).* 

    *Пример конфига в режиме 802.3ad*

    
    ```
    auto eth0
    iface eth0 inet manual
        bond-master bond0
    
    auto eth1
    iface eth1 inet manual
        bond-master bond0
    
    auto bond0
    iface bond0 inet static
        address 192.168.1.10
        gateway 192.168.1.1
        netmask 255.255.255.0
        bond-mode 4
        bond-miimon 100
        bond-lacp-rate 1
        bond-slaves eth0 eth1
    ```

5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

    *Ответ: 8*  
    *2^(32-29) = 2^3 = 8*  
    *Но использовать под хосты можно 6. 8-2 = 6 (1 адрес подсети, 1 широковещательный адрес).*

    *Внутри /24 сети можно уместить 32 сети /29. Примеры:*

    ```
    10.10.10.0/29
    10.10.10.8/29
    10.10.10.16/29
   ```

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

    *Можно использовать из сети 100.64.0.0/10.*  
    *Для 40-50 хостов лучше всего подходит сети /26, максимум на 62 хоста. Сети будут:*

    ```
    100.64.0.0/26
    100.64.0.64/26
    100.64.0.128/26
    и т.д.
    ```

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

    **Linux**

    *Посмотреть*

    `$ ip n`

    *Очистить полностью*

    `$ sudo ip n flush all`

    *Удалить конкретный узел с ip адресом IPADDR*

    `$ sudo ip n flush IPADDR`

    **Windows**

    *Посмотреть*

    `> arp -a`

    *Очистить полностью (нужны права админа)*

    `> arp -d *`

    *Удалить конкретный узел с ip адресом IPADDR (нужны права админа)*

    `> arp -d IPADDR`